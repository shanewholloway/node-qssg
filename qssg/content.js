// Generated by CoffeeScript 1.4.0
var ContentBase, ContentCollectionMixin, ContentComposite, ContentItem, ContentRoot, ContentTree,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __slice = [].slice;

ContentBase = (function() {

  function ContentBase() {}

  Object.defineProperties(ContentBase.prototype, {
    dependencies: {
      get: function() {
        return this.deps;
      }
    },
    deps: {
      get: function() {
        return this.deps = [];
      }
    }
  });

  ContentBase.prototype.isContentItem = function() {
    return true;
  };

  ContentBase.prototype.init = function(container, options) {
    var k, v, _results;
    if (options != null) {
      _results = [];
      for (k in options) {
        v = options[k];
        _results.push(this[k] = v);
      }
      return _results;
    }
  };

  ContentBase.prototype.visit = function(visitor, keyPath) {
    throw new Error("Subclass responsibility: " + this.constructor.name + "::visit()");
  };

  ContentBase.prototype.compositeWith = function(contentItem, key, container) {
    var comp;
    comp = new this._.ContentComposite(container, key);
    comp.addItem(key, contentItem);
    return comp;
  };

  return ContentBase;

})();

ContentItem = (function(_super) {

  __extends(ContentItem, _super);

  ContentItem.prototype.kind = 'item';

  function ContentItem(container, key, renderFn) {
    this.key = key;
    this.renderFn = renderFn;
  }

  ContentItem.prototype.visit = function(visitor, keyPath) {
    if (keyPath == null) {
      keyPath = [];
    }
    return visitor(this.kind, this, keyPath.concat([this.key]));
  };

  return ContentItem;

})(ContentBase);

ContentComposite = (function(_super) {

  __extends(ContentComposite, _super);

  ContentComposite.prototype.kind = 'list';

  function ContentComposite(container, key, renderFn) {
    this.key = key;
    this.renderFn = renderFn;
    this.list = [];
  }

  ContentComposite.prototype.addItem = function(key, item) {
    if (!item.isContentItem()) {
      throw new Error("Can only add ContentItem objects");
    }
    this.list.push(item);
    return item;
  };

  ContentComposite.prototype.compositeWith = function(contentItem, key, container) {
    this.list.push(contentItem);
    return this;
  };

  ContentComposite.prototype.visit = function(visitor, keyPath) {
    var res;
    if (keyPath == null) {
      keyPath = [];
    }
    res = visitor(this.kind, this, keyPath.slice());
    if (res === false) {

    } else {
      return this.visitList(visitor, keyPath);
    }
  };

  ContentComposite.prototype.visitList = function(visitor, keyPath) {
    var each, _i, _len, _ref;
    if (keyPath == null) {
      keyPath = [];
    }
    _ref = this.list;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      each = _ref[_i];
      each.visit(visitor, keyPath);
    }
    return true;
  };

  return ContentComposite;

})(ContentBase);

ContentTree = (function(_super) {

  __extends(ContentTree, _super);

  ContentTree.prototype.kind = 'tree';

  function ContentTree(container, key, renderFn) {
    this.key = key;
    this.renderFn = renderFn;
    this.items = {};
  }

  ContentTree.prototype.addItem = function(key, item) {
    var curItem;
    if (!item.isContentItem()) {
      throw new Error("Can only add ContentItem objects");
    }
    if ((curItem = this.items[key]) != null) {
      item = curItem.compositeWith(item, key, this);
    }
    this.items[key] = item;
    return item;
  };

  ContentTree.prototype.visit = function(visitor, keyPath) {
    var res;
    if (keyPath == null) {
      keyPath = [];
    }
    keyPath = keyPath.concat([this.key]);
    res = visitor(this.kind, this, keyPath.slice());
    if (res === false) {

    } else {
      return this.visitItems(visitor, keyPath);
    }
  };

  ContentTree.prototype.visitItems = function(visitor, keyPath) {
    var each, key, _ref;
    if (keyPath == null) {
      keyPath = [];
    }
    _ref = this.items;
    for (key in _ref) {
      each = _ref[key];
      each.visit(visitor, keyPath);
    }
    return true;
  };

  return ContentTree;

})(ContentBase);

ContentRoot = (function(_super) {

  __extends(ContentRoot, _super);

  ContentRoot.prototype.kind = 'root';

  function ContentRoot(key, renderFn) {
    ContentRoot.__super__.constructor.call(this, null, key, renderFn);
  }

  return ContentRoot;

})(ContentComposite);

ContentCollectionMixin = (function() {

  function ContentCollectionMixin() {}

  ContentCollectionMixin.prototype.ContentItem = ContentItem;

  ContentCollectionMixin.prototype.ContentTree = ContentTree;

  ContentCollectionMixin.prototype.newContent = function(container, key, renderFn) {
    return new this.ContentItem(container, key, renderFn);
  };

  ContentCollectionMixin.prototype.addContent = function() {
    var args, item, key, renderFn;
    key = arguments[0], renderFn = arguments[1], args = 3 <= arguments.length ? __slice.call(arguments, 2) : [];
    item = this.newContent(this, key, renderFn);
    if (args.length != null) {
      item.init.apply(item, [this].concat(__slice.call(args)));
    }
    return this.addItem(key, item);
  };

  ContentCollectionMixin.prototype.newTree = function(container, key, renderFn) {
    return new (this.ContentTree || this.constructor)(container, key, renderFn);
  };

  ContentCollectionMixin.prototype.addTree = function() {
    var args, item, key, renderFn;
    key = arguments[0], renderFn = arguments[1], args = 3 <= arguments.length ? __slice.call(arguments, 2) : [];
    item = this.newTree(this, key, renderFn);
    if (args.length != null) {
      item.init.apply(item, [this].concat(__slice.call(args)));
    }
    return this.addItem(key, item);
  };

  ContentCollectionMixin.mixInto = function(tgtClass) {
    var k, tgt, v, _ref;
    tgt = tgtClass.prototype || tgtClass;
    _ref = this.prototype;
    for (k in _ref) {
      v = _ref[k];
      tgt[k] = v;
    }
  };

  return ContentCollectionMixin;

})();

ContentCollectionMixin.mixInto(ContentTree);

ContentCollectionMixin.mixInto(ContentComposite);

module.exports = {
  ContentBase: ContentBase,
  ContentCollectionMixin: ContentCollectionMixin,
  ContentItem: ContentItem,
  ContentTree: ContentTree,
  ContentRoot: ContentRoot,
  createRoot: function(renderFn) {
    return new ContentRoot(renderFn);
  }
};
